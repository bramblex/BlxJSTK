(function(k,g){(function(e,c){c=c||e;e=Array.isArray(e)&&e||[];if("function"===typeof g&&g.amd)g(e,c);else if("function"===typeof g&&g.cmd)g(e,function(a,d,h){h.exports=c.apply(k,e.map(function(b){return a(b)}))});else if("object"===typeof exports)module.exports=c.apply(k,e.map(function(a){return require(a)}));else{var d=document.currentScript.src.replace(/(^.*?)([^\/]+)\.(js)(\?.*$|$)/,"$2"),d=d.replace(".min","");k[d]=c.apply(k,e.map(function(a){return k[a.replace(/^.*\//,"")]}))}})(["./EventEmitter"],
function(e){var c=e.extend("BaseTask");c.method("constructor",function(){c.uper("constructor").apply(this,arguments);this.status="stop"});c.method("start",function(){this.status="start";this.emit("end",data,1);this.start="start"});var d=c.extend("TaskUnit");d.method("constructor",function(b){d.uper("constructor").apply(this);this.func=b});d.method("start",function(b){if(this.status===START)throw"Task is aready ran";this.status=START;_this=this;setTimeout(function(){_this.emit("start",b);_this.func(b,
function(b,f){"number"!==typeof f&&(f=1);_this.emit("end",b,f);_this.status=STOP})},0)});d.method("fork",function(){return d(this.func)});var a=c.extend("TaskSequence");a.method("constructor",function(){a.uper("constructor").apply(this);this.pc=0;this.sequence=[]});var g=function(b,a,f){"number"!==typeof f&&(f=1);_next=arguments.callee;b.pc+=f;b.emit("next",a,f);if(b.pc<b.sequeue_length){var c=b.sequence[b.pc];c.once("end",function(a,f){_next(b,a,f)});c.start(a)}else b.pc=0,b.status=STOP,b.emit("end",
a,f)};a.method("start",function(b){if(this.status===START)throw"Task is aready ran";this.status=START;this.sequeue_length=this.sequence.length;var a=this;setTimeout(function(){a.emit("start",b);g(a,b,0)},0)});a.method("excute",function(b){this.sequence.push(h(b));return this});a.method("branch",function(b,a){this.excute(function(a,c){b(a)?c(a,1):c(a,2)});this.excute(a)});a.method("loop",function(b,a){this.excute(a);this.excute(function(a,c){b(a)?c(a,-1):c(a,1)});return this});a.method("times",function(b,
a){this.excute(a);this.excute(function(a,c){0<b?(c(a,-1),b--):c(a,1)});return this});a.method("fork",function(){var b=a();this.sequence.forEach(function(a){b.excute(a.fork())});return b});var h=function(b){if(0===arguments.length)return a();if("function"===typeof b)return d(b);if(b instanceof c)return b.fork();throw"Arguments type error";};h.BaseTask=c;h.TaskUnit=d;h.TaskSequence=a;return h})})(this,"undefined"!==typeof define&&define);
